version: 0.2

env:
    variables:
        CDK_LOCATION: CLOUD
        AWS_DOMAIN: gylfie
        AWS_REPOSITORY: gylfie

phases:
    install:
        runtime-versions:
            # python: latest
            nodejs: latest
        commands:
            # - "printenv"
            - "aws --version"
            - "npm -v"
            - "npm install -g pnpm@'^6.x.x' @microsoft/rush"
    pre_build:
        commands:
            - "rush update --no-link --recheck --purge"
            - "rush install --no-link"
            - "rush link"
            - "aws codeartifact login --domain gylfie --repository gylfie --tool npm --namespace @gylfie"
            # - "python ./scripts/co_login.py"
    build:
        commands:
            - "rush rebuild --verbose"
    post_build:
        commands:
            - "pnpm -r publish packages"
